<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI EMPLOYEE /// CONTROL ROOM</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,600;0,700;1,400;1,700&family=Instrument+Serif:ital@0;1&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --paper: #f8f6f1;
            --ink: #0d0d0d;
            --accent: #ff4d00;
            --accent-dim: #ff8c4d;
            --green: #00cc66;
            --blue: #0066ff;
            --yellow: #ffcc00;
            --red: #ff0066;
            --shadow: rgba(0, 0, 0, 0.15);
            --border-w: 3px;
        }

        @keyframes slide-in {
            from { transform: translateX(-40px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pop-in {
            0% { transform: scale(0.85) rotate(-2deg); opacity: 0; }
            60% { transform: scale(1.03) rotate(1deg); }
            100% { transform: scale(1) rotate(0); opacity: 1; }
        }

        @keyframes badge-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); }
        }

        @keyframes number-tick {
            0% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
            100% { transform: translateY(0); }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 16px;
        }

        body {
            font-family: 'DM Sans', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--paper);
            color: var(--ink);
            min-height: 100vh;
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* Grid Overlay */
        body::before {
            content: '';
            position: fixed;
            inset: 0;
            background-image:
                repeating-linear-gradient(0deg, transparent, transparent 19px, rgba(13, 13, 13, 0.03) 20px),
                repeating-linear-gradient(90deg, transparent, transparent 19px, rgba(13, 13, 13, 0.03) 20px);
            pointer-events: none;
            z-index: 0;
        }

        .masthead {
            background: var(--ink);
            color: var(--paper);
            padding: 2.5rem 3rem;
            border-bottom: var(--border-w) solid var(--accent);
            position: relative;
            overflow: hidden;
        }

        .masthead::after {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 400px;
            height: 100%;
            background: linear-gradient(135deg, transparent 0%, rgba(255, 77, 0, 0.1) 100%);
            pointer-events: none;
        }

        .masthead-inner {
            max-width: 1600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .publication-mark {
            display: flex;
            align-items: baseline;
            gap: 0.75rem;
        }

        .publication-title {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 3.5rem;
            font-weight: 400;
            line-height: 0.9;
            font-style: italic;
            letter-spacing: -0.02em;
        }

        .publication-subtitle {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: var(--accent-dim);
            margin-top: 0.25rem;
        }

        .issue-info {
            text-align: right;
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            line-height: 1.6;
        }

        .issue-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
        }

        .status-bar {
            background: var(--yellow);
            padding: 0.6rem 3rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: var(--border-w) solid var(--ink);
        }

        .status-bar-inner {
            max-width: 1600px;
            margin: 0 auto;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            border: 2px solid var(--ink);
        }

        .status-dot.live {
            background: var(--green);
            animation: badge-pulse 2s ease-in-out infinite;
        }

        .status-dot.dead {
            background: var(--red);
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 3rem 3rem 4rem;
            position: relative;
            z-index: 1;
        }

        .section-header {
            margin-bottom: 2rem;
            display: flex;
            align-items: baseline;
            gap: 1rem;
        }

        .section-number {
            font-family: 'Space Mono', monospace;
            font-size: 1rem;
            font-weight: 700;
            color: var(--accent);
        }

        .section-title {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 3rem;
            font-style: italic;
            line-height: 1;
            letter-spacing: -0.01em;
        }

        .section-divider {
            flex: 1;
            height: var(--border-w);
            background: var(--ink);
            margin-left: 2rem;
            align-self: center;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 1.5rem;
            margin-bottom: 4rem;
        }

        .metric-box {
            background: white;
            border: var(--border-w) solid var(--ink);
            padding: 2rem 1.75rem;
            box-shadow: 8px 8px 0 var(--shadow);
            position: relative;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            animation: pop-in 0.4s ease backwards;
        }

        .metric-box:nth-child(1) { animation-delay: 0.05s; }
        .metric-box:nth-child(2) { animation-delay: 0.1s; }
        .metric-box:nth-child(3) { animation-delay: 0.15s; }
        .metric-box:nth-child(4) { animation-delay: 0.2s; }

        .metric-box:hover {
            transform: translate(-4px, -4px);
            box-shadow: 12px 12px 0 var(--shadow);
        }

        .metric-box.alert { border-color: var(--red); }
        .metric-box.warning { border-color: var(--yellow); }
        .metric-box.success { border-color: var(--green); }

        .metric-box.alert::after { content: ''; position: absolute; top: -3px; right: -3px; width: 20px; height: 20px; background: var(--red); }
        .metric-box.warning::after { content: ''; position: absolute; top: -3px; right: -3px; width: 20px; height: 20px; background: var(--yellow); }
        .metric-box.success::after { content: ''; position: absolute; top: -3px; right: -3px; width: 20px; height: 20px; background: var(--green); }

        .metric-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-family: 'Space Mono', monospace;
        }

        .metric-value {
            font-family: 'Space Mono', monospace;
            font-size: 4rem;
            font-weight: 700;
            line-height: 1;
            animation: number-tick 0.5s ease;
        }

        .metric-value.alert { color: var(--red); }
        .metric-value.warning { color: var(--yellow); }
        .metric-value.success { color: var(--green); }

        .layout-split {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 2.5rem;
            margin-bottom: 4rem;
        }

        .card-stack {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .card {
            background: white;
            border: var(--border-w) solid var(--ink);
            padding: 2rem;
            box-shadow: 6px 6px 0 var(--shadow);
            cursor: pointer;
            transition: all 0.2s ease;
            animation: slide-in 0.4s ease backwards;
        }

        .card:nth-child(1) { animation-delay: 0.1s; }
        .card:nth-child(2) { animation-delay: 0.15s; }
        .card:nth-child(3) { animation-delay: 0.2s; }

        .card:hover {
            transform: translate(-3px, -3px);
            box-shadow: 9px 9px 0 var(--shadow);
        }

        .card:active {
            transform: translate(2px, 2px);
            box-shadow: 2px 2px 0 var(--shadow);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
            gap: 1rem;
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 700;
            line-height: 1.2;
        }

        .card-badge {
            font-family: 'Space Mono', monospace;
            font-size: 0.65rem;
            font-weight: 700;
            text-transform: uppercase;
            padding: 0.35rem 0.75rem;
            background: var(--ink);
            color: var(--paper);
            white-space: nowrap;
            letter-spacing: 0.05em;
        }

        .card-badge.red { background: var(--red); }
        .card-badge.yellow { background: var(--yellow); color: var(--ink); }
        .card-badge.green { background: var(--green); }

        .card-meta {
            font-family: 'Space Mono', monospace;
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 0.75rem;
        }

        .card-preview {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #333;
        }

        .sidebar-panel {
            position: sticky;
            top: 2rem;
        }

        .panel {
            background: var(--ink);
            color: var(--paper);
            border: var(--border-w) solid var(--ink);
            padding: 2rem;
            box-shadow: 8px 8px 0 var(--shadow);
            margin-bottom: 2rem;
        }

        .panel-title {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 1.75rem;
            font-style: italic;
            margin-bottom: 1.5rem;
        }

        .nav-list {
            list-style: none;
        }

        .nav-item {
            padding: 0.85rem 1.25rem;
            border: 2px solid rgba(248, 246, 241, 0.2);
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.15s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 500;
        }

        .nav-item:hover {
            background: rgba(248, 246, 241, 0.1);
            border-color: var(--accent);
        }

        .nav-item.active {
            background: var(--accent);
            border-color: var(--accent);
            font-weight: 700;
        }

        .nav-count {
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
            font-weight: 700;
            background: var(--paper);
            color: var(--ink);
            padding: 0.2rem 0.6rem;
            min-width: 28px;
            text-align: center;
        }

        .nav-item.active .nav-count {
            background: var(--ink);
            color: var(--paper);
        }

        .watcher-grid {
            display: grid;
            gap: 1rem;
        }

        .watcher {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem;
            border: 2px solid rgba(248, 246, 241, 0.2);
        }

        .watcher-name {
            font-size: 0.9rem;
            font-weight: 600;
        }

        .watcher-status {
            font-family: 'Space Mono', monospace;
            font-size: 0.7rem;
            text-transform: uppercase;
            padding: 0.3rem 0.65rem;
            background: var(--paper);
            color: var(--ink);
            font-weight: 700;
            letter-spacing: 0.05em;
        }

        .watcher-status.live {
            background: var(--green);
            color: var(--ink);
        }

        .watcher-status.dead {
            background: var(--red);
            color: var(--paper);
        }

        .button {
            font-family: 'DM Sans', sans-serif;
            font-size: 0.95rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 1rem 2rem;
            border: var(--border-w) solid var(--ink);
            background: var(--paper);
            color: var(--ink);
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 4px 4px 0 var(--shadow);
            display: inline-flex;
            align-items: center;
            gap: 0.75rem;
        }

        .button:hover {
            transform: translate(-2px, -2px);
            box-shadow: 6px 6px 0 var(--shadow);
        }

        .button:active {
            transform: translate(2px, 2px);
            box-shadow: 0 0 0 var(--shadow);
        }

        .button.primary {
            background: var(--accent);
            color: var(--paper);
            border-color: var(--accent);
        }

        .button.success {
            background: var(--green);
            color: var(--ink);
            border-color: var(--green);
        }

        .button.danger {
            background: var(--red);
            color: var(--paper);
            border-color: var(--red);
        }

        .detail-modal {
            position: fixed;
            inset: 0;
            background: rgba(13, 13, 13, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
            padding: 2rem;
        }

        .detail-modal.active {
            display: flex;
        }

        .detail-content {
            background: var(--paper);
            border: var(--border-w) solid var(--ink);
            box-shadow: 16px 16px 0 rgba(0, 0, 0, 0.3);
            max-width: 900px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            animation: pop-in 0.3s ease;
        }

        .detail-header {
            background: var(--ink);
            color: var(--paper);
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: var(--border-w) solid var(--accent);
        }

        .detail-title {
            font-family: 'Instrument Serif', Georgia, serif;
            font-size: 2rem;
            font-style: italic;
            line-height: 1.2;
            padding-right: 2rem;
        }

        .close-button {
            font-family: 'Space Mono', monospace;
            font-size: 1.5rem;
            background: none;
            border: none;
            color: var(--paper);
            cursor: pointer;
            padding: 0;
            line-height: 1;
            transition: color 0.2s ease;
        }

        .close-button:hover {
            color: var(--accent);
        }

        .detail-body {
            padding: 2.5rem;
            line-height: 1.7;
            font-size: 1rem;
        }

        .detail-body h1, .detail-body h2, .detail-body h3 {
            font-family: 'Instrument Serif', Georgia, serif;
            font-style: italic;
            margin-top: 2rem;
            margin-bottom: 1rem;
            line-height: 1.2;
        }

        .detail-body h1 { font-size: 2.25rem; }
        .detail-body h2 { font-size: 1.75rem; }
        .detail-body h3 { font-size: 1.35rem; }

        .detail-body p {
            margin-bottom: 1.25rem;
        }

        .detail-body ul, .detail-body ol {
            margin-left: 1.5rem;
            margin-bottom: 1.25rem;
        }

        .detail-body li {
            margin-bottom: 0.5rem;
        }

        .detail-body code {
            font-family: 'Space Mono', monospace;
            background: #f0f0f0;
            padding: 0.2rem 0.5rem;
            font-size: 0.9em;
            border: 1px solid #ddd;
        }

        .detail-body pre {
            background: var(--ink);
            color: var(--paper);
            padding: 1.5rem;
            overflow-x: auto;
            margin: 1.5rem 0;
            border: var(--border-w) solid var(--ink);
        }

        .detail-body pre code {
            background: none;
            border: none;
            color: var(--paper);
        }

        .detail-body table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .detail-body th, .detail-body td {
            border: 2px solid var(--ink);
            padding: 0.75rem 1rem;
            text-align: left;
        }

        .detail-body th {
            background: var(--ink);
            color: var(--paper);
            font-weight: 700;
        }

        .detail-actions {
            padding: 2rem;
            background: #f0f0f0;
            border-top: var(--border-w) solid var(--ink);
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
        }

        .empty-state-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.3;
        }

        .empty-state-text {
            font-size: 1.1rem;
            color: #666;
        }

        .loading {
            text-align: center;
            padding: 4rem 2rem;
            font-family: 'Space Mono', monospace;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        .meta-info {
            display: grid;
            gap: 0.75rem;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: #f8f8f8;
            border: 2px solid var(--ink);
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
            font-family: 'Space Mono', monospace;
            font-size: 0.85rem;
        }

        .meta-label {
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .meta-value {
            color: #666;
        }

        @media (max-width: 1200px) {
            .metrics-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .layout-split {
                grid-template-columns: 1fr;
            }

            .sidebar-panel {
                position: static;
            }
        }

        @media (max-width: 768px) {
            .publication-title {
                font-size: 2.5rem;
            }

            .metrics-grid {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 2rem 1.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="masthead">
        <div class="masthead-inner">
            <div class="publication-mark">
                <div>
                    <div class="publication-title">AI Employee</div>
                    <div class="publication-subtitle">Control Room</div>
                </div>
            </div>
            <div class="issue-info">
                <div class="issue-number" id="issue-number">v1.0</div>
                <div>BRONZE TIER</div>
                <div id="current-time">LOADING...</div>
            </div>
        </div>
    </header>

    <div class="status-bar">
        <div class="status-bar-inner">
            <div class="status-item">
                <span>SYSTEM STATUS</span>
            </div>
            <div id="watcher-status-bar" style="display: flex; gap: 1.5rem;">
                <!-- Populated by JS -->
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Dashboard Metrics -->
        <div class="section-header">
            <span class="section-number">[01]</span>
            <h2 class="section-title">Current Operations</h2>
            <div class="section-divider"></div>
        </div>

        <div class="metrics-grid">
            <div class="metric-box alert">
                <div class="metric-label">Needs Action</div>
                <div class="metric-value alert" id="metric-action">0</div>
            </div>
            <div class="metric-box warning">
                <div class="metric-label">Pending Review</div>
                <div class="metric-value warning" id="metric-pending">0</div>
            </div>
            <div class="metric-box success">
                <div class="metric-label">Approved</div>
                <div class="metric-value success" id="metric-approved">0</div>
            </div>
            <div class="metric-box success">
                <div class="metric-label">Completed</div>
                <div class="metric-value success" id="metric-done">0</div>
            </div>
        </div>

        <!-- Main Content Layout -->
        <div class="section-header">
            <span class="section-number">[02]</span>
            <h2 class="section-title">Active Files</h2>
            <div class="section-divider"></div>
        </div>

        <div class="layout-split">
            <div class="card-stack" id="main-content">
                <div class="loading">INITIALIZING...</div>
            </div>

            <div class="sidebar-panel">
                <div class="panel">
                    <h3 class="panel-title">Navigation</h3>
                    <ul class="nav-list">
                        <li class="nav-item active" data-view="overview">
                            <span>Overview</span>
                        </li>
                        <li class="nav-item" data-view="needs_action">
                            <span>Needs Action</span>
                            <span class="nav-count" id="nav-count-action">0</span>
                        </li>
                        <li class="nav-item" data-view="pending_approval">
                            <span>Pending Approval</span>
                            <span class="nav-count" id="nav-count-pending">0</span>
                        </li>
                        <li class="nav-item" data-view="approved">
                            <span>Approved</span>
                            <span class="nav-count" id="nav-count-approved">0</span>
                        </li>
                        <li class="nav-item" data-view="done">
                            <span>Done</span>
                            <span class="nav-count" id="nav-count-done">0</span>
                        </li>
                        <li class="nav-item" data-view="plans">
                            <span>Plans</span>
                            <span class="nav-count" id="nav-count-plans">0</span>
                        </li>
                        <li class="nav-item" data-view="logs">
                            <span>Logs</span>
                            <span class="nav-count" id="nav-count-logs">0</span>
                        </li>
                    </ul>
                </div>

                <div class="panel">
                    <h3 class="panel-title">Watchers</h3>
                    <div class="watcher-grid" id="watcher-panel">
                        <!-- Populated by JS -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detail Modal -->
    <div class="detail-modal" id="detail-modal">
        <div class="detail-content">
            <div class="detail-header">
                <h3 class="detail-title" id="detail-title">Loading...</h3>
                <button class="close-button" onclick="closeDetailModal()">&times;</button>
            </div>
            <div class="detail-body" id="detail-body">
                <!-- Content loaded dynamically -->
            </div>
            <div class="detail-actions" id="detail-actions" style="display: none;">
                <!-- Action buttons -->
            </div>
        </div>
    </div>

    <script>
        let currentView = 'overview';
        let currentFile = null;
        let summaryData = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            updateClock();
            setInterval(updateClock, 1000);

            loadSummary();
            loadView('overview');

            // Auto-refresh every 30 seconds
            setInterval(() => {
                loadSummary();
                if (currentView !== 'overview') {
                    loadView(currentView);
                }
            }, 30000);
        });

        function updateClock() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour12: false });
            const dateStr = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
            document.getElementById('current-time').textContent = `${dateStr} // ${timeStr}`;
        }

        // Navigation
        document.querySelectorAll('.nav-item').forEach(item => {
            item.addEventListener('click', () => {
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                item.classList.add('active');
                currentView = item.dataset.view;
                loadView(currentView);
            });
        });

        async function loadSummary() {
            try {
                const response = await fetch('/api/summary');
                summaryData = await response.json();
                updateMetrics(summaryData.folder_counts);
                updateWatchers(summaryData.watchers);
            } catch (error) {
                console.error('Failed to load summary:', error);
            }
        }

        function updateMetrics(counts) {
            const action = (counts.inbox || 0) + (counts.needs_action || 0);
            document.getElementById('metric-action').textContent = action;
            document.getElementById('metric-pending').textContent = counts.pending_approval || 0;
            document.getElementById('metric-approved').textContent = counts.approved || 0;
            document.getElementById('metric-done').textContent = counts.done || 0;

            document.getElementById('nav-count-action').textContent = counts.needs_action || 0;
            document.getElementById('nav-count-pending').textContent = counts.pending_approval || 0;
            document.getElementById('nav-count-approved').textContent = counts.approved || 0;
            document.getElementById('nav-count-done').textContent = counts.done || 0;
            document.getElementById('nav-count-plans').textContent = counts.plans || 0;
            document.getElementById('nav-count-logs').textContent = counts.logs || 0;
        }

        function updateWatchers(watchers) {
            const statusBar = document.getElementById('watcher-status-bar');
            const panel = document.getElementById('watcher-panel');

            statusBar.innerHTML = Object.entries(watchers).map(([name, active]) => `
                <div class="status-item">
                    <span class="status-dot ${active ? 'live' : 'dead'}"></span>
                    <span>${formatWatcherName(name)}</span>
                </div>
            `).join('');

            panel.innerHTML = Object.entries(watchers).map(([name, active]) => `
                <div class="watcher">
                    <span class="watcher-name">${formatWatcherName(name)}</span>
                    <span class="watcher-status ${active ? 'live' : 'dead'}">
                        ${active ? 'ONLINE' : 'OFFLINE'}
                    </span>
                </div>
            `).join('');
        }

        function formatWatcherName(name) {
            return name.split('_').map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' ');
        }

        async function loadView(view) {
            const content = document.getElementById('main-content');
            content.innerHTML = '<div class="loading">LOADING...</div>';

            if (view === 'overview') {
                renderOverview();
            } else {
                await renderFileList(view);
            }
        }

        function renderOverview() {
            const counts = summaryData?.folder_counts || {};

            const cards = [
                {
                    title: 'Review Pending Items',
                    count: counts.pending_approval || 0,
                    badge: 'URGENT',
                    badgeClass: 'yellow',
                    description: 'Items waiting for your approval or rejection decision',
                    action: () => loadView('pending_approval')
                },
                {
                    title: 'Process Action Items',
                    count: counts.needs_action || 0,
                    badge: 'PRIORITY',
                    badgeClass: 'red',
                    description: 'New items detected that require immediate processing',
                    action: () => loadView('needs_action')
                },
                {
                    title: 'View Activity Logs',
                    count: counts.logs || 0,
                    badge: 'INFO',
                    badgeClass: 'green',
                    description: 'Recent system activity and complete audit trail records',
                    action: () => loadView('logs')
                }
            ];

            document.getElementById('main-content').innerHTML = cards.map(card => `
                <div class="card" onclick="document.querySelector('[data-view=${card.action.toString().match(/loadView\('(.+)'\)/)[1]}]').click()">
                    <div class="card-header">
                        <div class="card-title">${card.title}</div>
                        <span class="card-badge ${card.badgeClass}">[${card.count}] ${card.badge}</span>
                    </div>
                    <div class="card-preview">${card.description}</div>
                </div>
            `).join('');
        }

        async function renderFileList(folder) {
            try {
                const response = await fetch(`/api/files/${folder}`);
                const data = await response.json();

                if (data.files.length === 0) {
                    document.getElementById('main-content').innerHTML = `
                        <div class="empty-state">
                            <div class="empty-state-icon">□</div>
                            <p class="empty-state-text">No files in this section</p>
                        </div>
                    `;
                    return;
                }

                document.getElementById('main-content').innerHTML = data.files.map(file => `
                    <div class="card" onclick='loadFileDetail("${encodeURIComponent(file.path)}", "${folder}")'>
                        <div class="card-header">
                            <div class="card-title">${escapeHtml(file.name)}</div>
                            ${getBadgeForFolder(folder)}
                        </div>
                        <div class="card-meta">
                            ${file.frontmatter?.type || 'document'} /// ${formatDate(file.modified)}
                        </div>
                        <div class="card-preview">${escapeHtml(file.preview)}</div>
                    </div>
                `).join('');
            } catch (error) {
                document.getElementById('main-content').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">!</div>
                        <p class="empty-state-text">Failed to load files</p>
                    </div>
                `;
            }
        }

        function getBadgeForFolder(folder) {
            const badges = {
                'needs_action': '<span class="card-badge red">ACTION</span>',
                'pending_approval': '<span class="card-badge yellow">PENDING</span>',
                'approved': '<span class="card-badge green">APPROVED</span>',
                'done': '<span class="card-badge green">DONE</span>',
                'plans': '<span class="card-badge">PLAN</span>',
                'logs': '<span class="card-badge">LOG</span>'
            };
            return badges[folder] || '';
        }

        async function loadFileDetail(encodedPath, folder) {
            const path = decodeURIComponent(encodedPath);
            currentFile = { path, folder };

            const modal = document.getElementById('detail-modal');
            modal.classList.add('active');

            try {
                const response = await fetch(`/api/file/content?path=${encodedPath}`);
                const data = await response.json();

                document.getElementById('detail-title').textContent = data.name;

                let bodyHTML = '';

                if (Object.keys(data.frontmatter).length > 0) {
                    bodyHTML += '<div class="meta-info">';
                    for (const [key, value] of Object.entries(data.frontmatter)) {
                        bodyHTML += `
                            <div class="meta-item">
                                <span class="meta-label">${key}</span>
                                <span class="meta-value">${value}</span>
                            </div>
                        `;
                    }
                    bodyHTML += '</div>';
                }

                bodyHTML += data.html;

                document.getElementById('detail-body').innerHTML = bodyHTML;

                const actions = document.getElementById('detail-actions');
                if (folder === 'pending_approval') {
                    actions.style.display = 'flex';
                    actions.innerHTML = `
                        <button class="button success" onclick="approveFile()">✓ APPROVE</button>
                        <button class="button danger" onclick="rejectFile()">✗ REJECT</button>
                    `;
                } else {
                    actions.style.display = 'none';
                }
            } catch (error) {
                document.getElementById('detail-body').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">!</div>
                        <p class="empty-state-text">Failed to load file</p>
                    </div>
                `;
            }
        }

        function closeDetailModal() {
            document.getElementById('detail-modal').classList.remove('active');
            currentFile = null;
        }

        async function approveFile() {
            if (!currentFile) return;

            try {
                const response = await fetch('/api/approve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ path: currentFile.path })
                });

                const result = await response.json();

                if (result.success) {
                    alert('✓ Item approved successfully!');
                    closeDetailModal();
                    loadSummary();
                    loadView(currentView);
                } else {
                    alert('✗ Failed to approve: ' + result.error);
                }
            } catch (error) {
                alert('✗ Error: ' + error.message);
            }
        }

        async function rejectFile() {
            if (!currentFile) return;

            const reason = prompt('Enter rejection reason:');
            if (!reason) return;

            try {
                const response = await fetch('/api/reject', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        path: currentFile.path,
                        reason: reason
                    })
                });

                const result = await response.json();

                if (result.success) {
                    alert('✓ Item rejected');
                    closeDetailModal();
                    loadSummary();
                    loadView(currentView);
                } else {
                    alert('✗ Failed to reject: ' + result.error);
                }
            } catch (error) {
                alert('✗ Error: ' + error.message);
            }
        }

        function formatDate(isoString) {
            if (!isoString) return '';
            const date = new Date(isoString);
            return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) + ' ' +
                   date.toLocaleTimeString('en-US', { hour: '2-digit', minute:'2-digit', hour12: false });
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
